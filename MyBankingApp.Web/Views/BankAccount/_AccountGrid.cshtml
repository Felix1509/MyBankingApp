@model List<MyBankingApp.Data.Entitites.Bankkonto>

@if (Model != null && Model.Any())
{
    @Html.DevExpress().GridView(settings =>
        {
            settings.Name = "BankAccountGrid";
            settings.Width = System.Web.UI.WebControls.Unit.Percentage(100);

            // Callback-Routes
            settings.CallbackRouteValues = new { Controller = "BankAccount", Action = "AccountGridCallback" };

            // Features
            settings.Settings.ShowGroupPanel = true;
            settings.Settings.ShowFilterRow = true;
            settings.Settings.ShowFooter = true;
            settings.Settings.ShowHeaderFilterButton = true;

            settings.SettingsBehavior.AllowGroup = true;
            settings.SettingsBehavior.AllowSort = true;
            settings.SettingsBehavior.AllowFocusedRow = true;

            // Paging
            settings.SettingsPager.Visible = true;
            settings.SettingsPager.PageSize = 10;

            // Columns
            settings.Columns.Add(column =>
            {
                column.FieldName = "Bankname";
                column.Caption = "Bank";
                column.GroupIndex = 0;
                column.SortOrder = DevExpress.Data.ColumnSortOrder.Ascending;
            });

            settings.Columns.Add(column =>
            {
                column.FieldName = "Kontoinhaber";
                column.Caption = "Kontoinhaber";
            });

            settings.Columns.Add(column =>
            {
                column.FieldName = "IBAN";
                column.Caption = "IBAN";
                column.Width = System.Web.UI.WebControls.Unit.Percentage(25);
            });

            settings.Columns.Add(column =>
            {
                column.FieldName = "Kontotyp";
                column.Caption = "Typ";
                column.Settings.HeaderFilterMode = HeaderFilterMode.CheckedList;
            });

            settings.Columns.Add(column =>
            {
                column.FieldName = "Waehrung";
                column.Caption = "Währung";
                column.Width = System.Web.UI.WebControls.Unit.Pixel(80);
                column.Settings.HeaderFilterMode = HeaderFilterMode.CheckedList;
            });

            settings.Columns.Add(column =>
            {
                column.FieldName = "AktuellerSaldo";
                column.Caption = "Saldo";
                column.PropertiesEdit.DisplayFormatString = "C";

                column.SetDataItemTemplateContent(c =>
                {
                    var saldo = (decimal)DataBinder.Eval(c.DataItem, "AktuellerSaldo");
                    var cssClass = saldo >= 0 ? "text-success" : "text-danger";
                    Html.ViewContext.Writer.Write(string.Format("<strong class='{0}'>{1:C}</strong>", cssClass, saldo));
                });

                settings.TotalSummary.Add(DevExpress.Data.SummaryItemType.Sum, "AktuellerSaldo").DisplayFormat = "Gesamt: {0:C}";
            });

            settings.Columns.Add(column =>
            {
                column.Caption = "Aktionen";
                column.Width = System.Web.UI.WebControls.Unit.Pixel(150);
                column.Settings.AllowSort = DevExpress.Utils.DefaultBoolean.False;
                column.Settings.AllowHeaderFilter = DevExpress.Utils.DefaultBoolean.False;

                column.SetDataItemTemplateContent(c =>
                {
                    var accountId = DataBinder.Eval(c.DataItem, "Id");
                    var detailsUrl = Url.Action("Details", "BankAccount", new { id = accountId });
                    var transactionsUrl = Url.Action("Index", "Transaction", new { kontoId = accountId });
                    var accessUrl = Url.Action("ManageAccess", "BankAccount", new { id = accountId });

                    Html.ViewContext.Writer.Write(
                        string.Format(
                            "<a href='{0}' class='btn btn-sm btn-outline-primary' title='Details'><i class='fas fa-eye'></i></a> " +
                            "<a href='{1}' class='btn btn-sm btn-outline-secondary' title='Transaktionen'><i class='fas fa-list'></i></a> " +
                            "<a href='{2}' class='btn btn-sm btn-outline-info' title='Zugriff'><i class='fas fa-users'></i></a>",
                            detailsUrl, transactionsUrl, accessUrl
                        )
                    );
                });
            });

            // Styling
            settings.Styles.Header.BackColor = System.Drawing.Color.FromArgb(249, 250, 251);
            settings.Styles.Header.Font.Bold = true;
            settings.Styles.GroupRow.Font.Bold = true;
            settings.Styles.GroupRow.BackColor = System.Drawing.Color.FromArgb(243, 244, 246);
            settings.Styles.Footer.Font.Bold = true;
            settings.Styles.Footer.BackColor = System.Drawing.Color.FromArgb(249, 250, 251);
            settings.Styles.AlternatingRow.BackColor = System.Drawing.Color.FromArgb(248, 249, 250);

        }).Bind(Model).GetHtml()
}
else
{
    <div style="text-align: center; padding: 40px; color: #6b7280;">
        <i class="fas fa-university fa-3x" style="color: #e5e7eb; margin-bottom: 20px; display: block;"></i>
        <h4>Keine Bankkonten gefunden</h4>
        <p>Fügen Sie Ihr erstes Bankkonto hinzu, um loszulegen.</p>
        <a href="@Url.Action("Create", "BankAccount")" class="btn btn-primary">
            <i class="fas fa-plus"></i> Bankkonto hinzufügen
        </a>
    </div>
}

<style type="text/css">
    .text-success {
        color: #10b981 !important;
    }

    .text-danger {
        color: #ef4444 !important;
    }

    .btn-outline-primary {
        color: #667eea;
        border: 1px solid #667eea;
        background: transparent;
    }

    .btn-outline-secondary {
        color: #6b7280;
        border: 1px solid #6b7280;
        background: transparent;
    }

    .btn-outline-info {
        color: #0891b2;
        border: 1px solid #0891b2;
        background: transparent;
    }

    .btn:hover {
        color: white;
    }

    .btn-outline-primary:hover {
        background: #667eea;
    }

    .btn-outline-secondary:hover {
        background: #6b7280;
    }

    .btn-outline-info:hover {
        background: #0891b2;
    }
</style>